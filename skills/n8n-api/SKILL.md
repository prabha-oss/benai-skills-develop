---
name: n8n-api
description: All n8n workflow operations via REST API. Use for listing, getting, creating, updating, deleting, activating/deactivating workflows, managing tags, variables, executions, and source control.
---

# n8n-api Skill

**Purpose**: All n8n workflow operations via REST API

---

## Pre-Flight Checklist

Before executing any operation, you MUST verify the setup by reading the `.env` file in the current working directory.

### Step 1: Read .env File

Use the Read tool to check for `.env` in the current working directory.

### Step 2: Handle Missing .env File

**IMPORTANT**: If `.env` doesn't exist, you MUST immediately create it using the Write tool with this content:

```
# BenAI n8n Skills Configuration
# Generated by benai-skills plugin

N8N_API_URL=
N8N_API_KEY=
N8N_CREDENTIALS_TEMPLATE_URL=
```

Do NOT ask the user to create this file - create it yourself automatically.

### Step 3: Check Required Variables

After reading or creating `.env`, check that these variables have values:

| Variable | Required | Description |
|----------|----------|-------------|
| `N8N_API_URL` | Yes | n8n instance URL (no trailing slash) |
| `N8N_API_KEY` | Yes | n8n API key |

### Step 4: Prompt for Missing Values

If `N8N_API_URL` or `N8N_API_KEY` is empty, ask the user:

```
n8n API Configuration Required

Please provide:
1. Your n8n instance URL (e.g., https://your-n8n.app.n8n.cloud)
2. Your n8n API key

You can find your API key in n8n at: Settings -> API -> Create API Key
```

After user provides values, update `.env` with the values using the Edit tool.

---

## API Call Format

**IMPORTANT**: Always use this exact format for API calls to avoid encoding issues:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/ENDPOINT" -H "X-N8N-API-KEY: ${N8N_API_KEY}"
```

For POST/PATCH/DELETE requests, add the method and data:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/api/v1/ENDPOINT" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d 'JSON_DATA'
```

**Key points:**
- Load env vars first with `export $(cat .env | grep -v '^#' | xargs)`
- Use double quotes around URL and header values with variable interpolation
- Use single quotes around JSON data
- Pipe to `| jq .` for formatted output

---

## READ Operations

### List All Workflows

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### Get Workflow by ID

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### List Tags

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/tags" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### List Variables

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/variables" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### List Executions

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/executions" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### Get Execution by ID

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/executions/{EXECUTION_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

---

## WRITE Operations

### Create Workflow

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/api/v1/workflows" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{
  "name": "My Workflow",
  "nodes": [],
  "connections": {},
  "settings": {"executionOrder": "v1"}
}' | jq .
```

### Update Workflow

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X PATCH "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{
  "name": "Updated Name",
  "nodes": [],
  "connections": {}
}' | jq .
```

### Delete Workflow

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X DELETE "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### Activate Workflow

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X PATCH "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{"active": true}' | jq .
```

### Deactivate Workflow

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X PATCH "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{"active": false}' | jq .
```

### Create Tag

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/api/v1/tags" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{"name": "production"}' | jq .
```

### Create Variable

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/api/v1/variables" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{"key": "MY_VAR", "value": "my-value"}' | jq .
```

### Delete Variable

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X DELETE "${N8N_API_URL}/api/v1/variables/{VARIABLE_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

---

## Workflow Execution

### Execute Workflow via Webhook

For workflows with webhook triggers:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/webhook/{WEBHOOK_PATH}" -H "Content-Type: application/json" -d '{"key": "value"}' | jq .
```

### Execute Workflow via Test Webhook

For testing webhook workflows (requires workflow to be open in n8n):

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/webhook-test/{WEBHOOK_PATH}" -H "Content-Type: application/json" -d '{"key": "value"}' | jq .
```

---

## Source Control Operations

### Pull from Remote

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/api/v1/source-control/pull" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{"force": false}' | jq .
```

### Push to Remote

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s -X POST "${N8N_API_URL}/api/v1/source-control/push" -H "X-N8N-API-KEY: ${N8N_API_KEY}" -H "Content-Type: application/json" -d '{"message": "Update workflows"}' | jq .
```

---

## Workflow JSON Structure

When creating or updating workflows, use this structure:

```json
{
  "name": "Workflow Name",
  "nodes": [
    {
      "id": "unique-node-id",
      "name": "Node Display Name",
      "type": "n8n-nodes-base.nodeName",
      "typeVersion": 1,
      "position": [250, 300],
      "parameters": {},
      "credentials": {}
    }
  ],
  "connections": {
    "Source Node Name": {
      "main": [
        [
          {
            "node": "Target Node Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  }
}
```

---

## Best Practices

### Creating Workflows

1. **Generate unique node IDs**: Use UUIDs or descriptive IDs
2. **Use proper positioning**: Start at [250, 300], space nodes ~200px apart
3. **Set executionOrder to "v1"**: Modern execution order
4. **Add error handling**: Include error outputs where appropriate

### Node Naming

- Use descriptive names: "Fetch Customer Data" not "HTTP Request"
- Avoid duplicate names within a workflow
- Keep names concise but meaningful

### Connections

- Connection keys use node **names**, not IDs
- Main outputs: `"main": [[{...}]]`
- Multiple outputs: `"main": [[{...}], [{...}]]`
- Error outputs connect to error handling nodes

---

## Error Handling

### Common API Errors

| Status | Meaning | Solution |
|--------|---------|----------|
| 401 | Unauthorized | Check API key is valid |
| 404 | Not found | Check workflow/execution ID exists |
| 400 | Bad request | Validate JSON structure |
| 409 | Conflict | Workflow name may be duplicate |

### Debugging Tips

1. Check `.env` values are correct (no trailing slash on URL)
2. Ensure API key has appropriate permissions
3. Verify n8n instance is running and accessible
4. Use `| jq .` to format JSON responses

---

## Integration with Other Skills

**For credentials in new nodes**:
-> Use the `benai-skills:n8n-credentials` skill to get credential references from the template

---

## Quick Reference

This skill handles ALL n8n operations:
- List/Get workflows
- Create/Update/Delete workflows
- Activate/Deactivate workflows
- List/Get executions
- Execute workflows via webhook
- Manage tags
- Manage variables
- Source control operations

Always read `.env` first to get `N8N_API_URL` and `N8N_API_KEY`.
