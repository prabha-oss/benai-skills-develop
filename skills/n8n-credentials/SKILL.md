---
name: n8n-credentials
description: Credential management via template workflow. Use when you need to get credentials for new nodes or list available credentials from the template.
---

# n8n-credentials Skill

**Purpose**: Credential management via template workflow - extract and apply credentials to new nodes

---

## Pre-Flight Checklist

Before executing any operation, you MUST verify the FULL setup by reading the `.env` file in the current working directory.

### Step 1: Read .env File

Use the Read tool to check for `.env` in the current working directory:

```
Read .env
```

### Step 2: Verify ALL Configuration

This skill requires ALL setup steps to be complete:

| Variable | Required | Description |
|----------|----------|-------------|
| `N8N_API_URL` | Yes | n8n instance URL |
| `N8N_API_KEY` | Yes | n8n API key |
| `N8N_MCP_CONFIGURED` | Yes (must be `true`) | MCP setup verified |
| `N8N_CREDENTIALS_TEMPLATE_ID` | Yes | Credentials template workflow ID |

### Step 3: Handle Missing Configuration

Run through ALL setup steps if any are missing:

#### If .env doesn't exist:
Create the file with the template:
```bash
# BenAI n8n Skills Configuration
# Generated by benai-skills plugin

N8N_API_URL=
N8N_API_KEY=
N8N_MCP_CONFIGURED=false
N8N_CREDENTIALS_TEMPLATE_ID=
```

#### Setup Step 1 - If N8N_API_URL or N8N_API_KEY is missing:
Ask the user:
```
Step 1 of 3: n8n API Configuration

Please provide:
1. Your n8n instance URL (e.g., https://your-n8n.app.n8n.cloud)
2. Your n8n API key

You can find your API key in n8n at: Settings → API → Create API Key
```

Update `.env` with the values using the Edit tool.

#### Setup Step 2 - If N8N_MCP_CONFIGURED is not "true":
Guide the user:
```
Step 2 of 3: n8n MCP Server Setup

Add the following to your Claude MCP configuration:

For Claude Desktop (~/Library/Application Support/Claude/claude_desktop_config.json):
{
  "mcpServers": {
    "n8n-mcp": {
      "command": "npx",
      "args": ["-y", "@n8n/mcp-server"],
      "env": {
        "N8N_API_URL": "<your-n8n-url>",
        "N8N_API_KEY": "<your-n8n-api-key>"
      }
    }
  }
}

After adding the configuration, restart Claude and confirm.
```

After user confirms, verify MCP is working by calling `mcp__n8n-mcp__n8n_health_check`. If successful, update `.env`:
```
N8N_MCP_CONFIGURED=true
```

#### Setup Step 3 - If N8N_CREDENTIALS_TEMPLATE_ID is missing:
Ask the user:
```
Step 3 of 3: Credentials Template Workflow

To manage credentials, you need a template workflow that contains nodes with your configured credentials.

Please provide the workflow ID of your credentials template.

You can find this by:
1. Open your credentials template workflow in n8n
2. Look at the URL: https://your-n8n.app.n8n.cloud/workflow/WORKFLOW_ID
3. Copy the WORKFLOW_ID

What is your credentials template workflow ID?
```

Update `.env` with the value.

---

## What is a Credentials Template?

A **Credentials Template** is a workflow you create in n8n that contains nodes with all your configured credentials. This allows the skill to:

1. Fetch the template workflow
2. Extract credential references from nodes
3. Apply those credentials to new workflows

### Example Template Workflow Structure

Create a workflow in n8n with nodes for each service you use:

```
[Slack Node] → [Google Sheets Node] → [HTTP Request Node] → [OpenAI Node]
     ↓               ↓                      ↓                    ↓
  Slack API    Google OAuth2           API Key Auth         OpenAI API
```

Each node should have credentials configured. The template doesn't need to be active or do anything - it's just a credential reference.

---

## Operations

### 1. Fetch Credentials Template

Get the full template workflow to extract credentials:

```
mcp__n8n-mcp__n8n_get_workflow(
  id: "${N8N_CREDENTIALS_TEMPLATE_ID}",
  mode: "full"
)
```

### 2. List Available Credentials

After fetching the template, parse the nodes to list available credentials:

```javascript
// Parse the template response
const template = response.workflow;
const credentials = {};

template.nodes.forEach(node => {
  if (node.credentials) {
    Object.entries(node.credentials).forEach(([credType, credRef]) => {
      credentials[node.type] = {
        type: credType,
        id: credRef.id,
        name: credRef.name
      };
    });
  }
});
```

Present to user:
```
Available Credentials from Template:

| Node Type | Credential Type | Credential Name |
|-----------|-----------------|-----------------|
| n8n-nodes-base.slack | slackApi | Slack Production |
| n8n-nodes-base.googleSheets | googleSheetsOAuth2Api | Google Workspace |
| n8n-nodes-base.openAi | openAiApi | OpenAI GPT-4 |
```

### 3. Get Credentials for Node Type

When creating a new node that needs credentials:

```
// From the parsed template
const nodeType = "n8n-nodes-base.slack";
const credential = credentials[nodeType];

// Returns:
{
  "slackApi": {
    "id": "cred-abc123",
    "name": "Slack Production"
  }
}
```

### 4. Apply Credentials to New Node

When building a workflow, add the credentials reference to the node:

```json
{
  "id": "new-node-id",
  "name": "Send Slack Message",
  "type": "n8n-nodes-base.slack",
  "typeVersion": 2,
  "position": [450, 300],
  "parameters": {
    "resource": "message",
    "operation": "send",
    "channel": "#general",
    "text": "Hello from n8n!"
  },
  "credentials": {
    "slackApi": {
      "id": "cred-abc123",
      "name": "Slack Production"
    }
  }
}
```

---

## Workflow: Creating Nodes with Credentials

### Step-by-Step Process

1. **User requests**: "Create a Slack workflow"

2. **Fetch template**:
   ```
   mcp__n8n-mcp__n8n_get_workflow(id: "${N8N_CREDENTIALS_TEMPLATE_ID}", mode: "full")
   ```

3. **Parse for Slack credentials**:
   - Find node with `type: "n8n-nodes-base.slack"`
   - Extract its `credentials` object

4. **Get node schema**:
   ```
   mcp__n8n-mcp__get_node(nodeType: "n8n-nodes-base.slack", detail: "standard")
   ```

5. **Build node with credentials**:
   ```json
   {
     "id": "slack-node-1",
     "name": "Send Message",
     "type": "n8n-nodes-base.slack",
     "typeVersion": 2.2,
     "position": [450, 300],
     "parameters": {...},
     "credentials": {
       "slackApi": {
         "id": "<from-template>",
         "name": "<from-template>"
       }
     }
   }
   ```

6. **Create workflow** using n8n-api skill

---

## Credential Types Reference

Common credential type names used in n8n:

| Service | Credential Type |
|---------|-----------------|
| Slack | `slackApi`, `slackOAuth2Api` |
| Google Sheets | `googleSheetsOAuth2Api` |
| Gmail | `gmailOAuth2` |
| OpenAI | `openAiApi` |
| HTTP Request | `httpHeaderAuth`, `httpBasicAuth`, `httpQueryAuth` |
| PostgreSQL | `postgres` |
| MySQL | `mySql` |
| Airtable | `airtableTokenApi` |
| Notion | `notionApi` |
| GitHub | `githubApi`, `githubOAuth2Api` |
| Stripe | `stripeApi` |
| Twilio | `twilioApi` |
| SendGrid | `sendGridApi` |
| AWS | `aws` |

---

## Error Handling

### Template Not Found
```
Error: Could not fetch credentials template.

Check that:
1. N8N_CREDENTIALS_TEMPLATE_ID in .env is correct
2. The workflow exists and hasn't been deleted
3. Your API key has access to this workflow
```

### No Credentials for Node Type
```
Note: No credentials found in template for node type: n8n-nodes-base.{type}

Options:
1. Add a {type} node with credentials to your template workflow
2. Skip credentials for this node (if it doesn't require them)
3. Manually add credentials after creating the workflow
```

### Template Has No Credentials
```
Warning: The credentials template workflow has no nodes with credentials.

Please add nodes with configured credentials to your template workflow,
then try again.
```

---

## Integration with Other Skills

**To read workflow/node info**:
→ Use the `n8n-mcp` skill

**To create/update workflows with credentials**:
1. Use this skill to get credentials
2. Use `n8n-api` skill to create the workflow

---

## Quick Reference

This skill handles:
- Fetching credentials template
- Listing available credentials
- Getting credentials for specific node types
- Applying credentials to new node configurations

**Required .env variables**:
- `N8N_API_URL`
- `N8N_API_KEY`
- `N8N_MCP_CONFIGURED=true`
- `N8N_CREDENTIALS_TEMPLATE_ID`

**Primary MCP tool used**:
- `mcp__n8n-mcp__n8n_get_workflow` (to fetch template)
