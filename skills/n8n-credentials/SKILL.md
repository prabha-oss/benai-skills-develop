---
name: n8n-credentials
description: Get full node configurations (credentials + parameters) from template workflow. Use when adding nodes that need authentication like Google Sheets, Airtable, Slack, Gmail, OpenAI, Notion. Copy credentials, parameters, and typeVersion from working template nodes.
---

# n8n-credentials Skill

**Purpose**: Extract FULL node configurations from template workflow - credentials AND all parameters

---

## PREREQUISITE: Load n8n-main First

**STOP! Before using this skill, the `n8n-main` skill MUST be loaded first.**

If `n8n-main` has NOT been loaded yet in this conversation:
1. **Load `n8n-main` skill NOW** using the Skill tool
2. Wait for it to complete its setup (reading files, checking .env)
3. Then return to this skill

```
n8n-main NOT loaded? → LOAD IT FIRST → Then use this skill
```

**Why:** n8n-main reads critical reference files (pitfalls.md, build-process.md) and verifies .env configuration. Without it, you'll make avoidable mistakes.

---

## Before Starting (MANDATORY)

**You MUST complete these steps before using this skill:**

1. **Read `.env` file** - Check N8N_API_URL, N8N_API_KEY, N8N_CREDENTIALS_TEMPLATE_URL
2. **If `.env` missing or incomplete** - Create it or ask user for values
3. **Load `n8n-nodes` skill** - To know correct typeVersions and parameters

```
READ .env → VERIFY all values set → LOAD n8n-nodes skill → FETCH template
```

**Do NOT proceed until .env is complete and n8n-nodes skill is loaded.**

---

## CRITICAL: Copy Full Configuration, Not Just Credentials

**IMPORTANT**: When using template nodes, you MUST copy the **ENTIRE node configuration**, not just credentials:

| What to Copy | Why |
|--------------|-----|
| `credentials` | Authentication for the service |
| `parameters` | All settings (resource, operation, options, etc.) |
| `typeVersion` | Ensures compatibility with your n8n version |

**Template nodes contain tested, working configurations. Use them as your base.**

---

## Pre-Flight Checklist

Before executing any operation, you MUST verify the FULL setup by reading the `.env` file in the current working directory.

### Step 1: Read .env File

Use the Read tool to check for `.env` in the current working directory.

### Step 2: Handle Missing .env File

**IMPORTANT**: If `.env` doesn't exist, you MUST immediately create it using the Write tool with this content:

```
# BenAI n8n Skills Configuration
# Generated by benai-skills plugin

N8N_API_URL=
N8N_API_KEY=
N8N_CREDENTIALS_TEMPLATE_URL=
```

Do NOT ask the user to create this file - create it yourself automatically.

### Step 3: Check ALL Required Variables

This skill requires ALL variables to be set:

| Variable | Required | Description |
|----------|----------|-------------|
| `N8N_API_URL` | Yes | n8n instance URL (no trailing slash) |
| `N8N_API_KEY` | Yes | n8n API key |
| `N8N_CREDENTIALS_TEMPLATE_URL` | Yes | Credentials template workflow URL |

### Step 4: Handle Missing Values

#### If ANY required variable is empty (N8N_API_URL, N8N_API_KEY, or N8N_CREDENTIALS_TEMPLATE_URL):

Ask the user for ALL missing values in a SINGLE prompt:
```
n8n Configuration Required

Please provide your n8n configuration:

1. n8n Instance URL
   Your n8n server address (e.g., https://your-n8n.app.n8n.cloud)

2. n8n API Key
   Found at: Settings -> API -> Create API Key

3. Credentials Template Workflow URL
   A workflow containing nodes with your configured credentials
   (e.g., https://your-n8n.app.n8n.cloud/workflow/abc123)
```

Update `.env` with all values using the Edit tool.

---

## API Call Format

**IMPORTANT**: Always use this exact format for API calls to avoid encoding issues:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/ENDPOINT" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

---

## What is a Credentials Template?

A **Credentials Template** is a workflow you create in n8n that contains nodes with all your configured credentials AND working parameters. This allows the skill to:

1. Fetch the template workflow
2. Extract **full node configurations** (credentials + parameters + typeVersion)
3. Apply those configurations to new workflows

### Example Template Workflow Structure

Create a workflow in n8n with nodes for each service you use:

```
[Slack Node] -> [Google Sheets Node] -> [HTTP Request Node] -> [OpenAI Node]
     |               |                      |                    |
  Slack API    Google OAuth2           API Key Auth         OpenAI API
```

**Each node should have:**
- Credentials configured
- Parameters set to common/default values you use
- The template doesn't need to be active

---

## Operations

### 1. Fetch Template and Get Full Node Configuration

First, extract the workflow ID from `N8N_CREDENTIALS_TEMPLATE_URL` (the last path segment of the URL).

**Fetch specific node type with FULL configuration:**
```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq '.nodes[] | select(.type | contains("slack"))'
```

**Fetch all nodes with credentials:**
```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq '.nodes[] | select(.credentials)'
```

### 2. List Available Node Configurations

After fetching the template, present available nodes to user:

```
Available Node Configurations from Template:

| Node Type | Node Name | Has Credentials |
|-----------|-----------|-----------------|
| n8n-nodes-base.slack | Slack | slackApi ✓ |
| n8n-nodes-base.googleSheets | Google Sheets | googleSheetsOAuth2Api ✓ |
| @apify/n8n-nodes-apify.apify | Apify | apifyApi ✓ |
| n8n-nodes-base.openAi | OpenAI | openAiApi ✓ |
```

### 3. Extract Full Node Configuration for Reuse

**CRITICAL**: Extract the ENTIRE node object, not just credentials:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq '.nodes[] | select(.type == "n8n-nodes-base.slack") | {type, typeVersion, parameters, credentials}'
```

This returns everything you need:
```json
{
  "type": "n8n-nodes-base.slack",
  "typeVersion": 2.2,
  "parameters": {
    "resource": "message",
    "operation": "post",
    "channel": {
      "__rl": true,
      "mode": "name",
      "value": "#general"
    },
    "text": "Hello!"
  },
  "credentials": {
    "slackApi": {
      "id": "abc123",
      "name": "Slack Production"
    }
  }
}
```

### 4. Create New Node from Template Configuration

When building a workflow, use the template node as your BASE:

```json
{
  "id": "new-unique-id",
  "name": "Send Notification",
  "type": "n8n-nodes-base.slack",
  "typeVersion": 2.2,
  "position": [450, 300],
  "parameters": {
    "resource": "message",
    "operation": "post",
    "channel": {
      "__rl": true,
      "mode": "name",
      "value": "#alerts"
    },
    "text": "={{ $json.message }}"
  },
  "credentials": {
    "slackApi": {
      "id": "abc123",
      "name": "Slack Production"
    }
  }
}
```

**What was copied from template:**
- `type` - exact node type
- `typeVersion` - ensures compatibility
- `credentials` - full credential reference
- `parameters` structure - only modified values that need to change

---

## Workflow: Creating Nodes from Template

### Step-by-Step Process

1. **User requests**: "Create a Slack workflow"

2. **Extract workflow ID from URL**:
   - From `N8N_CREDENTIALS_TEMPLATE_URL`, get the last path segment
   - e.g., `https://n8n.example.com/workflow/abc123` -> `abc123`

3. **Fetch template and find matching node**:
   ```bash
   export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/abc123" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq '.nodes[] | select(.type | contains("slack"))'
   ```

4. **Copy FULL configuration**:
   - Copy `type`, `typeVersion`, `parameters`, `credentials`
   - Only change: `id`, `name`, `position`, and specific parameter values as needed

5. **Build new node**:
   ```json
   {
     "id": "slack-node-1",
     "name": "Send Message",
     "type": "<from-template>",
     "typeVersion": "<from-template>",
     "position": [450, 300],
     "parameters": {
       // START WITH TEMPLATE PARAMETERS
       // Only modify what's needed for this use case
     },
     "credentials": {
       // COPY EXACTLY FROM TEMPLATE
     }
   }
   ```

6. **Create workflow** using benai-skills:n8n-main skill

---

## Common Pitfalls (AVOID THESE!)

### 1. Copying only credentials, not parameters
- **Wrong**: Just copy `credentials` and guess at `parameters`
- **Right**: Copy full node config including `parameters` and `typeVersion`

### 2. Using wrong typeVersion
- **Wrong**: Hardcode `typeVersion: 1`
- **Right**: Use the exact `typeVersion` from the template node

### 3. Missing parameter structure
- **Wrong**: `"channel": "#general"` (simple string)
- **Right**: Copy the exact structure from template (may need `__rl`, `mode`, etc.)

### 4. Not checking if node exists in template
- **Wrong**: Assume all node types exist in template
- **Right**: First list available nodes, inform user if requested type is missing

### 5. Building entire workflow at once
- **Wrong**: Add all nodes from template at once → test → error → hard to find which node failed
- **Right**: Add node 1 → test → add node 2 → test → incremental build with verification

### 6. Creating new workflows instead of updating
- **Wrong**: Create new workflow for each change or test
- **Right**: Create ONE workflow, use PUT to update it, keep same ID throughout

---

## Credential Types Reference

Common credential type names used in n8n:

| Service | Credential Type |
|---------|-----------------|
| Slack | `slackApi`, `slackOAuth2Api` |
| Google Sheets | `googleSheetsOAuth2Api` |
| Gmail | `gmailOAuth2` |
| OpenAI | `openAiApi` |
| HTTP Request | `httpHeaderAuth`, `httpBasicAuth`, `httpQueryAuth` |
| PostgreSQL | `postgres` |
| MySQL | `mySql` |
| Airtable | `airtableTokenApi` |
| Notion | `notionApi` |
| GitHub | `githubApi`, `githubOAuth2Api` |
| Stripe | `stripeApi` |
| Twilio | `twilioApi` |
| SendGrid | `sendGridApi` |
| AWS | `aws` |
| Apify | `apifyApi` |

---

## Error Handling

### Template Not Found
```
Error: Could not fetch credentials template.

Check that:
1. N8N_CREDENTIALS_TEMPLATE_URL in .env is correct
2. The workflow exists and hasn't been deleted
3. Your API key has access to this workflow
```

### Node Type Not in Template
```
Note: No node found in template for type: n8n-nodes-base.{type}

Options:
1. Add a {type} node with credentials to your template workflow
2. Ask user if they want to proceed without template config
3. Manually configure the node (may require UI setup for some nodes)
```

### Template Has No Configured Nodes
```
Warning: The credentials template workflow has no nodes with credentials.

Please add nodes with configured credentials to your template workflow,
then try again.
```

---

## Integration with Other Skills

**To create/update workflows with credentials**:
1. Use THIS skill to get full node configurations from template
2. Use `benai-skills:n8n-main` skill to create the workflow
3. **Test the workflow and debug until it works**
4. Only report success to user after confirmed working

---

## Incremental Build-Test Workflow (MANDATORY!)

**STOP! You MUST test after adding EACH node. No exceptions.**

### The Process (FOLLOW EXACTLY)
1. **Create** workflow with trigger only → **TEST** → verify works
2. **Add ONE node** from template → **TEST** → verify new node in runData
3. **Add next node** → **TEST** → verify
4. **Repeat** for each node
5. **Report** only after ALL nodes individually tested and working

### After EVERY Node Addition:
```bash
# 1. Execute
curl -X POST "${N8N_API_URL}/webhook/{path}" -d '{}'

# 2. Check status
curl "${N8N_API_URL}/api/v1/executions?limit=1" | jq '.data[0].status'

# 3. Verify node ran
curl "${N8N_API_URL}/api/v1/executions/{id}?includeData=true" | jq '.data.resultData.runData | keys'
```

**DO NOT add the next node until current node test passes!**

### What to Tell the User

**WRONG:**
```
Workflow created! Please test it and configure the Google Sheets node.
```

**RIGHT:**
```
✅ Workflow created and tested successfully!

- Name: LA Dentists to Google Sheets
- URL: https://n8n.example.com/workflow/abc123
- Status: Active and working
- Test result: Successfully scraped 100 dentists and saved to sheet

Note: You'll need to select the Google Sheet in the UI (this requires OAuth and can't be done via API).
```

**Key difference**: Be specific about what works, what was tested, and only mention manual steps if they're truly required (with explanation why).

---

## Quick Reference

This skill handles:
- Fetching credentials template via API
- Listing available node configurations (not just credentials!)
- Extracting FULL node config: `type`, `typeVersion`, `parameters`, `credentials`
- Providing base configurations for new nodes

**Required .env variables**:
- `N8N_API_URL`
- `N8N_API_KEY`
- `N8N_CREDENTIALS_TEMPLATE_URL`

**Key commands:**

Get all configured nodes:
```bash
jq '.nodes[] | select(.credentials)'
```

Get specific node type:
```bash
jq '.nodes[] | select(.type | contains("slack"))'
```

Get node config for reuse:
```bash
jq '.nodes[] | select(.type == "n8n-nodes-base.slack") | {type, typeVersion, parameters, credentials}'
```
