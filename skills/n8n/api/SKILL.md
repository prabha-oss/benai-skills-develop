---
name: n8n:api
description: WRITE operations via n8n REST API. Use when creating, updating, deleting, or activating/deactivating workflows, managing tags, variables, or source control.
---

# n8n:api Skill

**Purpose**: WRITE operations via n8n REST API (create, update, delete, activate workflows)

---

## Pre-Flight Checklist

Before executing any operation, you MUST verify the setup by reading the `.env` file in the current working directory.

### Step 1: Read .env File

Use the Read tool to check for `.env` in the current working directory.

### Step 2: Handle Missing .env File

**IMPORTANT**: If `.env` doesn't exist, you MUST immediately create it using the Write tool with this content:

```
# BenAI n8n Skills Configuration
# Generated by benai-skills plugin

N8N_API_URL=
N8N_API_KEY=
N8N_MCP_CONFIGURED=false
N8N_CREDENTIALS_TEMPLATE_URL=
```

Do NOT ask the user to create this file - create it yourself automatically.

### Step 3: Check Required Variables

After reading or creating `.env`, check that these variables have values:

| Variable | Required | Description |
|----------|----------|-------------|
| `N8N_API_URL` | Yes | n8n instance URL |
| `N8N_API_KEY` | Yes | n8n API key |

### Step 4: Prompt for Missing Values

If `N8N_API_URL` or `N8N_API_KEY` is empty, ask the user:

```
n8n API Configuration Required

Please provide:
1. Your n8n instance URL (e.g., https://your-n8n.app.n8n.cloud)
2. Your n8n API key

You can find your API key in n8n at: Settings -> API -> Create API Key
```

After user provides values, update `.env` with the values using the Edit tool.

---

## API Configuration

After reading `.env`, extract the values:
- `N8N_API_URL` - Base URL for all API calls
- `N8N_API_KEY` - Used in `X-N8N-API-KEY` header

**Important**: Remove trailing slash from `N8N_API_URL` if present.

---

## Available Operations

### Workflow CRUD Operations

#### Create Workflow
```bash
curl -X POST "${N8N_API_URL}/api/v1/workflows" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "My Workflow",
    "nodes": [...],
    "connections": {...},
    "settings": {
      "executionOrder": "v1"
    }
  }'
```

#### Update Workflow
```bash
curl -X PATCH "${N8N_API_URL}/api/v1/workflows/{id}" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Updated Name",
    "nodes": [...],
    "connections": {...}
  }'
```

#### Delete Workflow
```bash
curl -X DELETE "${N8N_API_URL}/api/v1/workflows/{id}" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}"
```

#### Activate Workflow
```bash
curl -X PATCH "${N8N_API_URL}/api/v1/workflows/{id}" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"active": true}'
```

#### Deactivate Workflow
```bash
curl -X PATCH "${N8N_API_URL}/api/v1/workflows/{id}" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"active": false}'
```

### Tags Operations

#### List Tags
```bash
curl -X GET "${N8N_API_URL}/api/v1/tags" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}"
```

#### Create Tag
```bash
curl -X POST "${N8N_API_URL}/api/v1/tags" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"name": "production"}'
```

### Variables Operations

#### List Variables
```bash
curl -X GET "${N8N_API_URL}/api/v1/variables" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}"
```

#### Create Variable
```bash
curl -X POST "${N8N_API_URL}/api/v1/variables" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"key": "MY_VAR", "value": "my-value"}'
```

#### Delete Variable
```bash
curl -X DELETE "${N8N_API_URL}/api/v1/variables/{id}" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}"
```

### Source Control Operations

#### Pull from Remote
```bash
curl -X POST "${N8N_API_URL}/api/v1/source-control/pull" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"force": false}'
```

#### Push to Remote
```bash
curl -X POST "${N8N_API_URL}/api/v1/source-control/push" \
  -H "X-N8N-API-KEY: ${N8N_API_KEY}" \
  -H "Content-Type: application/json" \
  -d '{"message": "Update workflows"}'
```

---

## Workflow JSON Structure

When creating or updating workflows, use this structure:

```json
{
  "name": "Workflow Name",
  "nodes": [
    {
      "id": "unique-node-id",
      "name": "Node Display Name",
      "type": "n8n-nodes-base.nodeName",
      "typeVersion": 1,
      "position": [250, 300],
      "parameters": {
        // Node-specific parameters
      },
      "credentials": {
        // Optional: credential references
      }
    }
  ],
  "connections": {
    "Source Node Name": {
      "main": [
        [
          {
            "node": "Target Node Name",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true,
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all"
  }
}
```

---

## Best Practices

### Creating Workflows

1. **Generate unique node IDs**: Use UUIDs or descriptive IDs
2. **Use proper positioning**: Start at [250, 300], space nodes ~200px apart
3. **Set executionOrder to "v1"**: Modern execution order
4. **Add error handling**: Include error outputs where appropriate

### Node Naming

- Use descriptive names: "Fetch Customer Data" not "HTTP Request"
- Avoid duplicate names within a workflow
- Keep names concise but meaningful

### Connections

- Connection keys use node **names**, not IDs
- Main outputs: `"main": [[{...}]]`
- Multiple outputs: `"main": [[{...}], [{...}]]`
- Error outputs connect to error handling nodes

---

## Error Handling

### Common API Errors

| Status | Meaning | Solution |
|--------|---------|----------|
| 401 | Unauthorized | Check API key is valid |
| 404 | Not found | Check workflow ID exists |
| 400 | Bad request | Validate JSON structure |
| 409 | Conflict | Workflow name may be duplicate |

### Validation Before API Calls

Before creating/updating workflows, use the n8n:mcp skill to validate:
```
mcp__n8n-mcp__validate_workflow(workflow: {...})
```

---

## Integration with Other Skills

**For READ operations** (list, get, search):
-> Use the `n8n:mcp` skill

**For credentials in new nodes**:
-> Use the `n8n:credentials` skill to get credential references from the template

---

## Quick Reference

This skill handles:
- Create workflows
- Update workflows
- Delete workflows
- Activate/deactivate workflows
- Manage tags
- Manage variables
- Source control operations

Always read `.env` first to get `N8N_API_URL` and `N8N_API_KEY`.
