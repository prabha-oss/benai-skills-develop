---
name: n8n:credentials
description: Credential management via template workflow. Use when you need to get credentials for new nodes or list available credentials from the template.
---

# n8n:credentials Skill

**Purpose**: Credential management via template workflow - extract and apply credentials to new nodes

---

## Pre-Flight Checklist

Before executing any operation, you MUST verify the FULL setup by reading the `.env` file in the current working directory.

### Step 1: Read .env File

Use the Read tool to check for `.env` in the current working directory.

### Step 2: Handle Missing .env File

**IMPORTANT**: If `.env` doesn't exist, you MUST immediately create it using the Write tool with this content:

```
# BenAI n8n Skills Configuration
# Generated by benai-skills plugin

N8N_API_URL=
N8N_API_KEY=
N8N_CREDENTIALS_TEMPLATE_URL=
```

Do NOT ask the user to create this file - create it yourself automatically.

### Step 3: Check ALL Required Variables

This skill requires ALL variables to be set:

| Variable | Required | Description |
|----------|----------|-------------|
| `N8N_API_URL` | Yes | n8n instance URL (no trailing slash) |
| `N8N_API_KEY` | Yes | n8n API key |
| `N8N_CREDENTIALS_TEMPLATE_URL` | Yes | Credentials template workflow URL |

### Step 4: Handle Missing Values

#### If N8N_API_URL or N8N_API_KEY is empty:
Ask the user:
```
Step 1 of 2: n8n API Configuration

Please provide:
1. Your n8n instance URL (e.g., https://your-n8n.app.n8n.cloud)
2. Your n8n API key

You can find your API key in n8n at: Settings -> API -> Create API Key
```

Update `.env` with the values using the Edit tool.

#### If N8N_CREDENTIALS_TEMPLATE_URL is empty:
Ask the user:
```
Step 2 of 2: Credentials Template Workflow

To manage credentials, you need a template workflow that contains nodes with your configured credentials.

Please provide the full URL of your credentials template workflow.

You can find this by:
1. Open your credentials template workflow in n8n
2. Copy the URL from your browser (e.g., https://your-n8n.app.n8n.cloud/workflow/abc123)

What is your credentials template workflow URL?
```

Update `.env` with the value.

---

## API Call Format

**IMPORTANT**: Always use this exact format for API calls to avoid encoding issues:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/ENDPOINT" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

---

## What is a Credentials Template?

A **Credentials Template** is a workflow you create in n8n that contains nodes with all your configured credentials. This allows the skill to:

1. Fetch the template workflow
2. Extract credential references from nodes
3. Apply those credentials to new workflows

### Example Template Workflow Structure

Create a workflow in n8n with nodes for each service you use:

```
[Slack Node] -> [Google Sheets Node] -> [HTTP Request Node] -> [OpenAI Node]
     |               |                      |                    |
  Slack API    Google OAuth2           API Key Auth         OpenAI API
```

Each node should have credentials configured. The template doesn't need to be active or do anything - it's just a credential reference.

---

## Operations

### 1. Fetch Credentials Template

First, extract the workflow ID from `N8N_CREDENTIALS_TEMPLATE_URL` (the last path segment of the URL).

Then fetch the template workflow:

```bash
export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/{WORKFLOW_ID}" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
```

### 2. List Available Credentials

After fetching the template, parse the nodes to list available credentials.

From the JSON response, look at the `nodes` array and extract credentials:

```javascript
// Parse the template response
const template = response;
const credentials = {};

template.nodes.forEach(node => {
  if (node.credentials) {
    Object.entries(node.credentials).forEach(([credType, credRef]) => {
      credentials[node.type] = {
        type: credType,
        id: credRef.id,
        name: credRef.name
      };
    });
  }
});
```

Present to user:
```
Available Credentials from Template:

| Node Type | Credential Type | Credential Name |
|-----------|-----------------|-----------------|
| n8n-nodes-base.slack | slackApi | Slack Production |
| n8n-nodes-base.googleSheets | googleSheetsOAuth2Api | Google Workspace |
| n8n-nodes-base.openAi | openAiApi | OpenAI GPT-4 |
```

### 3. Get Credentials for Node Type

When creating a new node that needs credentials, find the matching node type in the template:

```json
// From the parsed template, for node type "n8n-nodes-base.slack":
{
  "slackApi": {
    "id": "cred-abc123",
    "name": "Slack Production"
  }
}
```

### 4. Apply Credentials to New Node

When building a workflow, add the credentials reference to the node:

```json
{
  "id": "new-node-id",
  "name": "Send Slack Message",
  "type": "n8n-nodes-base.slack",
  "typeVersion": 2,
  "position": [450, 300],
  "parameters": {
    "resource": "message",
    "operation": "send",
    "channel": "#general",
    "text": "Hello from n8n!"
  },
  "credentials": {
    "slackApi": {
      "id": "cred-abc123",
      "name": "Slack Production"
    }
  }
}
```

---

## Workflow: Creating Nodes with Credentials

### Step-by-Step Process

1. **User requests**: "Create a Slack workflow"

2. **Extract workflow ID from URL**:
   - From `N8N_CREDENTIALS_TEMPLATE_URL`, get the last path segment
   - e.g., `https://n8n.example.com/workflow/abc123` -> `abc123`

3. **Fetch template**:
   ```bash
   export $(cat .env | grep -v '^#' | xargs) && curl -s "${N8N_API_URL}/api/v1/workflows/abc123" -H "X-N8N-API-KEY: ${N8N_API_KEY}" | jq .
   ```

4. **Parse for Slack credentials**:
   - Find node with `type: "n8n-nodes-base.slack"`
   - Extract its `credentials` object

5. **Build node with credentials**:
   ```json
   {
     "id": "slack-node-1",
     "name": "Send Message",
     "type": "n8n-nodes-base.slack",
     "typeVersion": 2.2,
     "position": [450, 300],
     "parameters": {...},
     "credentials": {
       "slackApi": {
         "id": "<from-template>",
         "name": "<from-template>"
       }
     }
   }
   ```

6. **Create workflow** using n8n:api skill

---

## Credential Types Reference

Common credential type names used in n8n:

| Service | Credential Type |
|---------|-----------------|
| Slack | `slackApi`, `slackOAuth2Api` |
| Google Sheets | `googleSheetsOAuth2Api` |
| Gmail | `gmailOAuth2` |
| OpenAI | `openAiApi` |
| HTTP Request | `httpHeaderAuth`, `httpBasicAuth`, `httpQueryAuth` |
| PostgreSQL | `postgres` |
| MySQL | `mySql` |
| Airtable | `airtableTokenApi` |
| Notion | `notionApi` |
| GitHub | `githubApi`, `githubOAuth2Api` |
| Stripe | `stripeApi` |
| Twilio | `twilioApi` |
| SendGrid | `sendGridApi` |
| AWS | `aws` |
| Apify | `apifyApi` |

---

## Error Handling

### Template Not Found
```
Error: Could not fetch credentials template.

Check that:
1. N8N_CREDENTIALS_TEMPLATE_URL in .env is correct
2. The workflow exists and hasn't been deleted
3. Your API key has access to this workflow
```

### No Credentials for Node Type
```
Note: No credentials found in template for node type: n8n-nodes-base.{type}

Options:
1. Add a {type} node with credentials to your template workflow
2. Skip credentials for this node (if it doesn't require them)
3. Manually add credentials after creating the workflow
```

### Template Has No Credentials
```
Warning: The credentials template workflow has no nodes with credentials.

Please add nodes with configured credentials to your template workflow,
then try again.
```

---

## Integration with Other Skills

**To create/update workflows with credentials**:
1. Use this skill to get credentials
2. Use `n8n:api` skill to create the workflow

---

## Quick Reference

This skill handles:
- Fetching credentials template via API
- Listing available credentials
- Getting credentials for specific node types
- Applying credentials to new node configurations

**Required .env variables**:
- `N8N_API_URL`
- `N8N_API_KEY`
- `N8N_CREDENTIALS_TEMPLATE_URL`

**API endpoint used**:
- `GET /api/v1/workflows/{id}` (to fetch template)
